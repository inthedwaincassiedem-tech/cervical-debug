<body class="flex flex-col h-screen p-4 bg-black text-green-500 font-mono">
    
    <header class="flex justify-between border-b border-green-900 pb-2 mb-2 text-[10px]">
        <span class="glow">ENGINE: CERVICAL_CORE_V2.1</span>
        <span id="timestamp"></span>
    </header>

    <main class="relative flex-grow border border-green-900 rounded overflow-hidden">
        <video id="input_video" class="hidden"></video>
        <canvas id="output_canvas" class="w-full h-full object-cover"></canvas>
        
        <div id="data-hud" class="absolute top-2 left-2 space-y-1">
            <div class="bg-black/60 p-1 border border-green-500/30">
                <div class="text-[8px] opacity-70">ANGLE</div>
                <div id="angle-val" class="text-xl font-bold">--°</div>
            </div>
            <div class="bg-black/60 p-1 border border-green-500/30">
                <div class="text-[8px] opacity-70">LOAD</div>
                <div id="load-val" class="text-xl font-bold text-orange-400">--kg</div>
            </div>
        </div>

        <div id="repair-modal" class="hidden absolute inset-0 bg-black/90 z-50 flex flex-col items-center justify-center p-6 text-center">
            <div class="text-orange-500 animate-pulse mb-2 text-xs">CRITICAL_OVERLOAD_DETECTED</div>
            <h2 id="step-title" class="text-lg font-bold mb-4">开始系统修复</h2>
            <div id="step-desc" class="text-xs opacity-80 mb-6 h-12">检测到颈椎力矩异常，请执行以下复位动作。</div>
            <div id="timer-display" class="text-5xl font-bold mb-8">10s</div>
            <button id="next-btn" onclick="startRepair()" class="border border-green-500 px-8 py-2 active:bg-green-500 active:text-black">立即执行</button>
        </div>
    </main>

    <footer class="mt-4 flex gap-2">
        <div class="flex-1 text-[8px] opacity-60">
            <div class="flex justify-between"><span>STABILITY:</span><span id="stab-val">0%</span></div>
            <div class="flex justify-between"><span>LATENCY:</span><span>24ms</span></div>
        </div>
        <button id="main-action-btn" class="flex-1 bg-green-900 text-[10px] py-2 rounded font-bold disabled:opacity-30">等待姿态稳定...</button>
    </footer>

    <script>
        // 核心修复逻辑变量
        let currentStep = 0;
        const REPAIR_STEPS = [
            { title: "动作 1: 寰枕卸载", desc: "头后缩，手掌抵住后脑勺向后微发力", time: 10 },
            { title: "动作 2: 胸椎伸展", desc: "双臂抱头，靠在椅背向上方延展", time: 15 },
            { title: "动作 3: 神经滑行", desc: "侧头至极限，对侧手掌向下压", time: 10 }
        ];

        // 监测逻辑更新
        function checkOverload(angle) {
            const modal = document.getElementById('repair-modal');
            const btn = document.getElementById('main-action-btn');
            
            if (angle > 25) { // 设定阈值
                btn.innerText = "发现风险: 点击修复";
                btn.classList.replace('bg-green-900', 'bg-orange-600');
                btn.onclick = () => { modal.classList.remove('hidden'); };
            }
        }

        // 动作引导逻辑
        function startRepair() {
            const title = document.getElementById('step-title');
            const desc = document.getElementById('step-desc');
            const timer = document.getElementById('timer-display');
            const btn = document.getElementById('next-btn');

            btn.style.display = 'none'; // 隐藏按钮强制执行
            const step = REPAIR_STEPS[currentStep];
            title.innerText = step.title;
            desc.innerText = step.desc;
            
            let timeLeft = step.time;
            const clock = setInterval(() => {
                timeLeft--;
                timer.innerText = timeLeft + "s";
                if (timeLeft <= 0) {
                    clearInterval(clock);
                    currentStep++;
                    if (currentStep < REPAIR_STEPS.length) {
                        btn.style.display = 'block';
                        btn.innerText = "进入下一步";
                    } else {
                        showFinalReport();
                    }
                }
            }, 1000);
        }

        function showFinalReport() {
            document.getElementById('repair-modal').innerHTML = `
                <div class="text-green-500 font-bold mb-4">DEBUG_SUCCESS</div>
                <div class="text-xs text-left space-y-2 mb-8">
                    <p>· 颈椎力矩已重置</p>
                    <p>· 肌肉张力下降预期: 40%</p>
                    <p>· 建议下次维护: 2小时后</p>
                </div>
                <button onclick="location.reload()" class="bg-green-600 text-black px-8 py-2 font-bold">保存并退出</button>
            `;
        }
    </script>
</body>
